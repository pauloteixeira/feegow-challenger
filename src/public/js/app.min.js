const btnAppointment=$("#btn-appoint"),selEspeciality=$("#sel-especiality"),selSource=$("#sel-source_id"),btnFindTime=$("#btn-find-time"),divAppointResult=$("#div-appoint-result"),titleAppointResult=$("#title-appoint-result"),divDataResult=$("#div-data-result-specialty"),birthdate=$("#birthdate"),cpf=$("#cpf"),alerta=$("#succ-alert");function toggleModalActionButton(e){btnFindTime.is(":disabled")&&""!=selSource.val()&&btnFindTime.prop("disabled",!1)}function toggleActionButton(e){btnAppointment.is(":disabled")&&""!=selEspeciality.val()&&btnAppointment.prop("disabled",!1)}function findSpecialties(e){""!=selEspeciality?findProfessionals():alert("Selecione uma especialidade.")}function findProfessionals(){divAppointResult.hide("slow"),post("/api/professionals/list",{especialidade_id:selEspeciality.val()},professionalsResultHandler)}function findPatientSource(){get("/api/patient/source/list",patientSourceHandler)}function findSpecialidades(){get("/api/specialties/list",specialtiesResultHandler)}function specialtiesResultHandler(e){let i=[];for(var t in i.push('<option value="" disabled selected>Selecione a especialidade</option>'),e)i.push("<option value='"+e[t].especialidade_id+"'>"+e[t].nome+"</option>");selEspeciality.empty().html(i.join(""))}function professionalsResultHandler(e){let i=e.length,t="";for(var a in e[0].especialidades)if(e[0].especialidades[a].especialidade_id==selEspeciality.val()){t=e[0].especialidades[a].nome_especialidade;break}let l=i+" Resultado(s) para "+t;titleAppointResult.val(l),divDataResult.empty().html(mountHtmlSpecialists(e,selEspeciality.val())),divAppointResult.show("slow")}function patientSourceHandler(e){let i=[];for(var t in i.push('<option value="" disabled selected>Como conheceu?</option>'),e)i.push("<option value='"+e[t].origem_id+"'>"+e[t].nome_origem+"</option>");selSource.empty().html(i.join(""))}function verifyIfTratamentoExists(e){return 0==String(e).length||"null"==e||null==e||null==e?"":e+" "}function mountHtmlSpecialists(e,i){let t=0,a="";for(var l in e){let o=verifyIfTratamentoExists(e[l].tratamento)+e[l].nome;1==++t&&(a+='<div class="row">'),a+='  <div class="col-md-3 border-box">',a+='      <div class="row">',a+='          <div class="col-md-4"><img src="/images/avatar.jpg" alt="avatar" width="50px"></div>',a+='          <div class="col-md-8 title-name-doctor">'+o+"</div>",a+="      </div>",a+='      <div class="row">',a+='           <div class="col-md-12">',a+='              <center><button type="button" class="btn btn-sm btn-success" onclick="doAppointment('+i+", '"+o+"',"+e[l].profissional_id+')" >AGENDAR</button></center>',a+="           </div>",a+="      </div>",a+="  </div>",3===t&&(a+="</div>",t=0)}return t<3&&0!=t&&(a+="</div>"),a}function doAppointment(e,i,t){$("#specialty_id").val(e),$("#professional_id").val(t),$("#modalLabel").empty().html("Agendar consulta com "+i),$("#modal-appointment").modal("toggle")}function doSaveAppointment(){console.log($("#specialty_id").val()),0!=$("#specialty_id").val().length?0!=$("#professional_id").val().length?0!=$("#name").val().length&&0!=$("#cpf").val().length&&0!=$("#birthdate").val().length&&0!=$("#sel-source_id").val().length?(post("/api/appointment/save",{specialty_id:$("#specialty_id").val(),professional_id:$("#professional_id").val(),source_id:$("#sel-source_id").val(),name:$("#name").val(),cpf:$("#cpf").val(),birthdate:$("#birthdate").val()}),clearAndCloseModal(),alerta.empty().html("Agendamento realizado com sucesso."),alerta.show("slow")):alert("Todos os campos do formulário são obrigatórios."):alert("Houve um problema ao selecionar o médico(a), favor refaça a operação completa."):alert("Houve um problema ao selecionar a especialidade, favor refaça a operação completa.")}function clearAndCloseModal(){$("#specialty_id").val(""),$("#professional_id").val(""),$("#sel-source_id").val($("#source_id option:first").val()),$("#name").val(""),$("#cpf").val(""),$("#birthdate").val(""),$("#modal-appointment").modal("toggle")}$(document).ready((function(){divAppointResult.hide(),selEspeciality.change(toggleActionButton),btnAppointment.click(findSpecialties),findSpecialidades(),findPatientSource(),birthdate.mask("99/99/9999"),cpf.mask("999.999.999-99"),alerta.hide()}));